<?xml version="1.0" encoding="UTF-8"?>

<?xml-stylesheet href="https://moise-exceptions.sourceforge.io/xml/os.xsl" type="text/xsl" ?>

<organisational-specification
    id="prescription_org" os-version="1.0"
    
    xmlns="https://moise-exceptions.sourceforge.io/os"
    
    xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
    xsi:schemaLocation="https://moise-exceptions.sourceforge.io/os https://moise-exceptions.sourceforge.io/xml/0.3/os.xsd">

    <structural-specification>

        <role-definitions>
            <role id="patient" />
            <role id="doctor" />
            <role id="pharmacist" />
        </role-definitions>

        <group-specification id="prescription_group">
            <roles>
                <role id="patient" min="1" max="1" />
                <role id="doctor" min="1" max="1" />
                <role id="pharmacist" min="1" max="1" />
            </roles>
        </group-specification>

    </structural-specification>

    <functional-specification>

        <scheme id="prescription_sch">

            <goal id="prescription" ttf="5 seconds">
                <plan operator="sequence">
                    <goal id="sendComplain" />
                    <goal id="completePrescription">
                        <plan operator="parallel">
                            <goal id="receiveFilled" />
                            <goal id="prescribeAndFill">
                                <plan operator="sequence">
                                    <goal id="receiveComplain" />
                                    <goal id="sendPrescribe" />
                                    <goal id="receivePrescribe" />
                                    <goal id="sendFilled" />
                                </plan>
                            </goal>
                        </plan>
                    </goal>
                </plan>
            </goal>

            <notification-policy id="resend" target="getMedication" condition="failed(_,waitForDrugs)">
                <exception-specification id="prescriptionDelay">
                    <exception-argument id="..." arity="..." />
                    <raising-goal id="raiseDelayException" />
                    <handling-goal id="receiveResentComplain" />
                </exception-specification>
            </notification-policy>

            <!-- <notification-policy id="remind1" target="sendPrescription"
                    condition="unfulfilled(obligation(_,_,done(S,sendPrescription,_),_))">
                <exception-specification id="complaintException">
                    <raising-goal id="resendComplaint" />
                    <handling-goal id="handleReminder" />
                </exception-specification>
            </notification-policy>

            <notification-policy id="remind2" target="receiveTreatment"
                    condition="failed(_,receiveTreatment)">
                <exception-specification id="treatmentException">
                    <raising-goal id="resendComplaint" />
                    <handling-goal id="handleReminder" />
                </exception-specification>
            </notification-policy>

            <notification-policy id="forward" target="receiveTreatment" condition="failed(_,receiveTreatment)">
                <exception-specification id="complaintException">
                    <raising-goal id="giveInformation" />
                    <handling-goal id="handleInformation">
                        <plan operator="choice">
                            <goal id="forwardPrescription" />
                            <goal id="resendComplaint" />
                        </plan>
                    </handling-goal>
                </exception-specification>
            </notification-policy>

            <notification-policy id="probe" target="sendPrescription"
                    condition="unfulfilled(obligation(_,_,done(_,sendPrescription,_),_))">
                <exception-specification id="complaintException">
                    <raising-goal id="probePrescription" />
                    <handling-goal id="resendPrescription" />
                </exception-specification>
            </notification-policy> -->

            <mission id="mPatient" min="1" max="1">
                <goal id="sendComplain" />
                <goal id="receiveFilled" />
                <goal id="resendComplain" />
            </mission>
            <mission id="mDoctor" min="1" max="1">
                <goal id="receiveComplain" />
                <goal id="sendPrescribe" />
                <goal id="receiveResentComplain" />
            </mission>
            <mission id="mPharmacist" min="1" max="1">
                <goal id="receivePrescribe" />
                <goal id="sendFilled" />
            </mission>

        </scheme>

    </functional-specification>

    <normative-specification>
        <norm id="n1" type="obligation" role="patient"    mission="mPatient" />
        <norm id="n2" type="obligation" role="doctor"     mission="mDoctor" />
        <norm id="n3" type="obligation" role="pharmacist" mission="mPharmacist" />
    </normative-specification>

</organisational-specification>
